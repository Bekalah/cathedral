<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è‚ú® CATHEDRAL OF CIRCUITS - GUILD WARS-STYLE RPG</title>
    <meta name="description" content="Guild Wars-style RPG with your authentic Codex 144:99 system, 22 Living Tradition Engines, and trauma-safe design">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=EB+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Loading screen styles */
        .game-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, #0B0B0B 0%, #141414 50%, #2C0A52 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #F8F5EF;
            font-family: 'EB Garamond', serif;
            z-index: 1000;
        }

        .loading-spinner {
            font-size: 4rem;
            animation: sacred-spin 3s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes sacred-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .loading-subtitle {
            font-size: 1rem;
            opacity: 0.8;
            max-width: 400px;
            text-align: center;
            line-height: 1.6;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="game-loading" id="loadingScreen">
        <div class="loading-spinner">üèõÔ∏è</div>
        <div class="loading-text">Initializing Sacred Journey...</div>
        <div class="loading-subtitle">
            Loading your authentic Codex 144:99 system with 22 Living Tradition Engines and Guild Wars-style gameplay
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="gameContainer" style="display: none;">
        <!-- Sacred Geometry Canvas will be inserted here -->
    </div>

    <script type="module">
        /**
         * üèõÔ∏è‚ú® CATHEDRAL OF CIRCUITS - GAME ENTRY POINT
         *
         * Native ES module initialization for your Guild Wars-style RPG
         * Loads your authentic Codex 144:99 system
         */

        // Global game interface reference
        window.gameInterface = null;

        // Loading screen management
        const loadingScreen = document.getElementById('loadingScreen');
        const gameContainer = document.getElementById('gameContainer');

        async function initializeGame() {
            try {
                console.log('üéÆ Initializing Cathedral of Circuits RPG...');

                // Dynamic import of your game engine
                const { createCathedralGame } = await import('./packages/game-engine/src/index.js');

                // Create game instance
                const game = await createCathedralGame();
                window.gameInterface = game;

                // Hide loading screen
                loadingScreen.style.display = 'none';
                gameContainer.style.display = 'block';

                console.log('‚úÖ Game initialized successfully');
                console.log('üéÆ Ready to start your sacred journey');

                // Start the game
                await startGameInterface(game);

            } catch (error) {
                console.error('‚ùå Failed to initialize game:', error);
                showError('Failed to load your sacred journey. Please refresh and try again.');
            }
        }

        async function startGameInterface(game) {
            try {
                // Start the game
                const gameStart = await game.startGame();

                console.log('üéÆ Game started!');
                console.log(`üë§ Character: ${gameStart.character.name}`);
                console.log(`üåü Starting Node: ${gameStart.startingNode.name}`);

                // Create the game interface
                await createGameUI(game);

            } catch (error) {
                console.error('Failed to start game:', error);
                showError('Failed to start your sacred journey.');
            }
        }

        async function createGameUI(game) {
            // Create the main game interface
            const gameUI = document.createElement('div');
            gameUI.className = 'cathedral-game-ui';
            gameUI.innerHTML = `
                <div class="game-header">
                    <h1>üèõÔ∏è‚ú® CATHEDRAL OF CIRCUITS RPG</h1>
                    <div class="game-status">
                        <span class="status-indicator">üü¢ Active</span>
                        <span class="node-indicator">Node: ${game.currentNode?.name || 'Loading...'}</span>
                    </div>
                </div>

                <div class="game-main">
                    <div class="character-panel">
                        <h3>üë§ Royal Initiate</h3>
                        <p>Selected Arcanae: ${game.activeCharacter?.selectedArcanae?.name || 'None'}</p>
                        <p>Level: ${game.activeCharacter?.level || 1}</p>
                    </div>

                    <div class="node-panel">
                        <h3>üåü Current Node</h3>
                        <p>${game.currentNode?.name || 'No node selected'}</p>
                        <p>${game.currentNode?.teaching_function || ''}</p>
                    </div>

                    <div class="actions-panel">
                        <h3>üéÆ Actions</h3>
                        <button class="action-button" onclick="selectArcanae()">Choose Arcanae Class</button>
                        <button class="action-button" onclick="navigateNodes()">Navigate Nodes</button>
                        <button class="action-button" onclick="activateFusion()">Fusion Kink Heaven</button>
                        <button class="safety-button" onclick="emergencyExit()">Emergency Exit</button>
                    </div>
                </div>

                <div class="safety-footer">
                    <p>üõ°Ô∏è Maximum CPTSD-Safe Design | ‚ù§Ô∏è ND Accommodations | üö® Emergency Exit Always Available</p>
                </div>
            `;

            // Add styles
            const style = document.createElement('style');
            style.textContent = `
                .cathedral-game-ui {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(11, 11, 11, 0.9);
                    backdrop-filter: blur(10px);
                    color: #F8F5EF;
                    font-family: 'EB Garamond', serif;
                    z-index: 100;
                    display: flex;
                    flex-direction: column;
                }

                .game-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem 2rem;
                    background: rgba(20, 20, 20, 0.8);
                    border-bottom: 1px solid rgba(200, 164, 77, 0.3);
                }

                .game-header h1 {
                    color: #FFD700;
                    font-size: 1.5rem;
                    text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
                }

                .game-main {
                    flex: 1;
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 2rem;
                    padding: 2rem;
                }

                .character-panel, .node-panel, .actions-panel {
                    background: rgba(20, 20, 20, 0.6);
                    border: 1px solid rgba(200, 164, 77, 0.2);
                    border-radius: 15px;
                    padding: 1.5rem;
                }

                .character-panel h3, .node-panel h3, .actions-panel h3 {
                    color: #FFD700;
                    margin-bottom: 1rem;
                    border-bottom: 1px solid rgba(200, 164, 77, 0.3);
                    padding-bottom: 0.5rem;
                }

                .action-button {
                    display: block;
                    width: 100%;
                    padding: 0.8rem;
                    margin-bottom: 0.5rem;
                    background: linear-gradient(135deg, #7A33FF, #B39CFF);
                    color: white;
                    border: none;
                    border-radius: 10px;
                    cursor: pointer;
                    font-family: 'EB Garamond', serif;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                }

                .action-button:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 5px 20px rgba(122, 51, 255, 0.4);
                }

                .safety-button {
                    background: linear-gradient(135deg, #FF4500, #FF6A00);
                    color: white;
                }

                .safety-button:hover {
                    background: linear-gradient(135deg, #FF6A00, #FF4500);
                    box-shadow: 0 5px 20px rgba(255, 69, 0, 0.4);
                }

                .safety-footer {
                    padding: 1rem 2rem;
                    background: rgba(20, 20, 20, 0.8);
                    border-top: 1px solid rgba(200, 164, 77, 0.3);
                    text-align: center;
                    font-size: 0.9rem;
                    color: #FFD700;
                }

                @media (max-width: 768px) {
                    .game-main {
                        grid-template-columns: 1fr;
                        gap: 1rem;
                        padding: 1rem;
                    }
                }
            `;

            document.head.appendChild(style);
            gameContainer.appendChild(gameUI);

            // Set up global functions for buttons
            window.selectArcanae = () => showArcanaeSelection(game);
            window.navigateNodes = () => showNodeNavigation(game);
            window.activateFusion = () => showFusionKink(game);
            window.emergencyExit = () => game.emergencyExit();
        }

        function showArcanaeSelection(game) {
            const availableArcanae = game.characterSystem.getAvailableArcanaeForCharacter(game.activeCharacter);

            const selectionHTML = `
                <div class="arcanae-selection">
                    <h2>üÉè Choose Your Arcanae Class</h2>
                    <p>Select from your 22 authentic tradition engines...</p>

                    <div class="arcanae-grid">
                        ${availableArcanae.map(arcana => `
                            <div class="arcanae-card">
                                <h3>${arcana.name}</h3>
                                <p><strong>Guardian:</strong> ${arcana.guardian_spirit}</p>
                                <p><strong>Tradition:</strong> ${arcana.tradition_engine}</p>
                                <p><strong>Teaching:</strong> ${arcana.core_teaching}</p>
                                <button onclick="window.gameInterface.selectArcanae('${arcana.name.toLowerCase()}')">
                                    Select This Path
                                </button>
                            </div>
                        `).join('')}
                    </div>

                    <button class="back-button" onclick="window.gameInterface.showView('menu')">
                        Back to Menu
                    </button>
                </div>
            `;

            gameContainer.innerHTML = selectionHTML;
        }

        function showNodeNavigation(game) {
            const accessibleNodes = game.gameState.getAccessibleNodes();

            const navigationHTML = `
                <div class="node-navigation">
                    <h2>üåü Navigate Sacred Nodes</h2>
                    <p>Your Codex 144:99 nodes await exploration...</p>

                    <div class="nodes-grid">
                        ${accessibleNodes.map(nodeId => {
                            const node = game.codexManager.getNode(nodeId);
                            return `
                                <div class="node-card">
                                    <h3>${node.name}</h3>
                                    <p><strong>Element:</strong> ${node.element}</p>
                                    <p><strong>Frequency:</strong> ${node.solfeggio} Hz</p>
                                    <p><strong>Teaching:</strong> ${node.teaching_function}</p>
                                    <button onclick="window.gameInterface.navigateToNode(${nodeId})">
                                        Explore This Node
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;

            gameContainer.innerHTML = navigationHTML;
        }

        function showFusionKink(game) {
            const fusionHTML = `
                <div class="fusion-kink">
                    <h2>‚öóÔ∏è Fusion Kink Heaven 144:99</h2>
                    <p>Sacred synthesis between your authentic nodes...</p>

                    <div class="fusion-interface">
                        <p>üõ°Ô∏è Consent required for all fusion activities</p>
                        <p>üî¢ Sacred ratio: 144:99 = 1.454545...</p>
                        <p>‚ö° 231 possible fusion combinations</p>

                        <div class="fusion-status">
                            <p>Status: Ready for sacred synthesis</p>
                            <p>Trauma Safety: MAXIMUM protocols active</p>
                        </div>
                    </div>
                </div>
            `;

            gameContainer.innerHTML = fusionHTML;
        }

        function showError(message) {
            loadingScreen.innerHTML = `
                <div class="loading-spinner">‚ùå</div>
                <div class="loading-text">Error Loading Game</div>
                <div class="loading-subtitle">${message}</div>
                <button onclick="location.reload()" style="
                    padding: 1rem 2rem;
                    background: linear-gradient(135deg, #7A33FF, #B39CFF);
                    color: white;
                    border: none;
                    border-radius: 15px;
                    cursor: pointer;
                    font-family: 'EB Garamond', serif;
                    font-size: 1rem;
                    margin-top: 2rem;
                ">Reload Game</button>
            `;
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', initializeGame);

        console.log('üèõÔ∏è‚ú® Cathedral of Circuits Game Interface Loading...');
        console.log('üìä Codex 144:99 system initializing...');
        console.log('üÉè 22 Living Tradition Engines ready...');
        console.log('‚öóÔ∏è Fusion Kink Heaven 144:99 active...');
        console.log('üõ°Ô∏è Maximum trauma safety protocols enabled...');
    </script>
</body>
</html>
